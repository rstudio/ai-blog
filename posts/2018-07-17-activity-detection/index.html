<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="radix" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->

<script type="text/json" id="radix-import-source">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["url","sha1"]}},"value":[{"type":"character","attributes":{},"value":["https://github.com/jjallaire/activity_detection_post"]},{"type":"character","attributes":{},"value":["35554881f9bc0df537789f1dd3b186af8d5b4b9c"]}]}
</script>
<!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
<title>RStudio AI Blog: Classifying physical activity from smartphone data</title>

<meta property="description" itemprop="description" content="Using Keras to train a convolutional neural network to classify physical activity. The dataset was built from the recordings of 30 subjects performing basic activities and postural transitions while carrying a waist-mounted smartphone with embedded inertial sensors."/>

<link rel="canonical" href="https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/png" href="../../images/favicon.png"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2018-07-17"/>
<meta property="article:created" itemprop="dateCreated" content="2018-07-17"/>
<meta name="article:author" content="Nick Strayer"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="RStudio AI Blog: Classifying physical activity from smartphone data"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Using Keras to train a convolutional neural network to classify physical activity. The dataset was built from the recordings of 30 subjects performing basic activities and postural transitions while carrying a waist-mounted smartphone with embedded inertial sensors."/>
<meta property="og:url" content="https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/"/>
<meta property="og:image" content="https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/index_files/figure-html5/unnamed-chunk-8-1.png"/>
<meta property="og:image:width" content="1152"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="RStudio AI Blog"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="RStudio AI Blog: Classifying physical activity from smartphone data"/>
<meta property="twitter:description" content="Using Keras to train a convolutional neural network to classify physical activity. The dataset was built from the recordings of 30 subjects performing basic activities and postural transitions while carrying a waist-mounted smartphone with embedded inertial sensors."/>
<meta property="twitter:url" content="https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/"/>
<meta property="twitter:image" content="https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/index_files/figure-html5/unnamed-chunk-8-1.png"/>
<meta property="twitter:image:width" content="1152"/>
<meta property="twitter:image:height" content="768"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="RStudio AI Blog: Classifying physical activity from smartphone data"/>
<meta name="citation_fulltext_html_url" content="https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2018/07/17"/>
<meta name="citation_publication_date" content="2018/07/17"/>
<meta name="citation_author" content="Nick Strayer"/>
<meta name="citation_author_institution" content="Vanderbilt University"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Efficient object localization using convolutional networks;citation_publication_date=2014;citation_volume=abs/1411.4280;citation_author=Jonathan Tompson;citation_author=Ross Goroshin;citation_author=Arjun Jain;citation_author=Yann LeCun;citation_author=Christoph Bregler"/>
  <meta name="citation_reference" content="citation_title=Transition-aware human activity recognition using smartphones;citation_publication_date=2016;citation_publisher=Elsevier;citation_volume=171;citation_author=Jorge-L Reyes-Ortiz;citation_author=Luca Oneto;citation_author=Albert SamÃ ;citation_author=Xavier Parra;citation_author=Davide Anguita"/>
  <meta name="citation_reference" content="citation_title=Supervised sequence labelling;citation_publication_date=2012;citation_publisher=Springer;citation_author=Alex Graves"/>
  <meta name="citation_reference" content="citation_title=Deep learning;citation_publication_date=2015;citation_publisher=Nature Publishing Group;citation_volume=521;citation_author=Yann LeCun;citation_author=Yoshua Bengio;citation_author=Geoffrey Hinton"/>
  <meta name="citation_reference" content="citation_title=Bayesian neural networks;citation_publication_date=1989;citation_publisher=Springer;citation_volume=61;citation_author=Igor Kononenko"/>
  <meta name="citation_reference" content="citation_title=Dropout as a bayesian approximation: Representing model uncertainty in deep learning;citation_publication_date=2016;citation_author=Yarin Gal;citation_author=Zoubin Ghahramani"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","creative_commons","repository_url","bibliography","output","resources","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Classifying physical activity from smartphone data"]},{"type":"character","attributes":{},"value":["Using Keras to train a convolutional neural network to classify physical activity. The dataset was built from the recordings of 30 subjects performing basic activities and postural transitions while carrying a waist-mounted smartphone with embedded inertial sensors."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation","affiliation_url"]}},"value":[{"type":"character","attributes":{},"value":["Nick Strayer"]},{"type":"character","attributes":{},"value":["http://nickstrayer.me"]},{"type":"character","attributes":{},"value":["Vanderbilt University"]},{"type":"character","attributes":{},"value":["https://www.vanderbilt.edu/biostatistics-graduate/"]}]}]},{"type":"character","attributes":{},"value":["07-17-2018"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["https://github.com/nstrayer/activity_detection_post"]},{"type":"character","attributes":{},"value":["bibliography.bib"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["radix::radix_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["exclude"]}},"value":[{"type":"character","attributes":{},"value":["data","*.rds","*.h5"]}]},{"type":"character","attributes":{},"value":["https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/"]},{"type":"character","attributes":{},"value":["https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["bibliography.bib","index_files/bowser-1.9.3/bowser.min.js","index_files/distill-2.2.21/template.v2.js","index_files/figure-html5/unnamed-chunk-12-1.png","index_files/figure-html5/unnamed-chunk-19-1.png","index_files/figure-html5/unnamed-chunk-20-1.png","index_files/figure-html5/unnamed-chunk-21-1.png","index_files/figure-html5/unnamed-chunk-22-1.png","index_files/figure-html5/unnamed-chunk-23-1.png","index_files/figure-html5/unnamed-chunk-8-1.png","index_files/jquery-1.11.3/jquery.min.js","index_files/pagedtable-1.1/css/pagedtable.css","index_files/pagedtable-1.1/js/pagedtable.js","index_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createIndex() {
  var options = {
    keys: [
      "title",
      "categories",
      "description",
      "contents"
    ]
  };
  return new window.Fuse([],options);
}

function createFuseIndex() {

  // create fuse index
  var options = { keys: ["title", "description", "contents"] };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
            keys: [
              { name: 'title', weight: 20 },
              { name: 'categories', weight: 15 },
              { name: 'description', weight: 10 },
              { name: 'contents', weight: 5 },
            ],
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
            .filter(function(item) { return !!item.description; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description}
                </div>
                <div class="search-item-preview">
                  <img src="${suggestion.preview ? offsetURL(suggestion.preview) : ''}"</img>
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: hidden;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
  <script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-20375833-3"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-20375833-3');
</script>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Classifying physical activity from smartphone data","description":"Using Keras to train a convolutional neural network to classify physical activity. The dataset was built from the recordings of 30 subjects performing basic activities and postural transitions while carrying a waist-mounted smartphone with embedded inertial sensors.","authors":[{"author":"Nick Strayer","authorURL":"http://nickstrayer.me","affiliation":"Vanderbilt University","affiliationURL":"https://www.vanderbilt.edu/biostatistics-graduate/","orcidID":""}],"publishedDate":"2018-07-17T00:00:00.000+00:00","citationText":"Strayer, 2018"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<span class="logo">
<img src="../../images/rstudio.png"/>
</span>
<a href="../../index.html" class="title">AI Blog</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../gallery.html">Gallery</a>
<a href="../../about.html">About</a>
<a href="../../contributing.html">Contributing</a>
<a href="../../index.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Classifying physical activity from smartphone data</h1>
<p>Using Keras to train a convolutional neural network to classify physical activity. The dataset was built from the recordings of 30 subjects performing basic activities and postural transitions while carrying a waist-mounted smartphone with embedded inertial sensors.</p>
</div>

<div class="d-byline">
  Nick Strayer <a href="http://nickstrayer.me" class="uri">http://nickstrayer.me</a> (Vanderbilt University)<a href="https://www.vanderbilt.edu/biostatistics-graduate/" class="uri">https://www.vanderbilt.edu/biostatistics-graduate/</a>
  
<br/>2018-07-15
</div>

<div class="d-article">
<h2 id="introduction">Introduction</h2>
<p>In this post weâll describe how to use smartphone accelerometer and gyroscope data to predict the physical activities of the individuals carrying the phones. The data used in this post comes from the <a href="http://archive.ics.uci.edu/ml/datasets/Smartphone-Based+Recognition+of+Human+Activities+and+Postural+Transitions">Smartphone-Based Recognition of Human Activities and Postural Transitions Data Set</a> distributed by the University of California, Irvine. Thirty individuals were tasked with performing various basic activities with an attached smartphone recording movement using an accelerometer and gyroscope.</p>
<p>Before we begin, letâs load the various libraries that weâll use in the analysis:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(keras)     # Neural Networks
library(tidyverse) # Data cleaning / Visualization
library(knitr)     # Table printing
library(rmarkdown) # Misc. output utilities 
library(ggridges)  # Visualization</code></pre>
</div>
<h2 id="activities-dataset">Activities dataset</h2>
<p>The data used in this post come from the <a href="http://archive.ics.uci.edu/ml/datasets/Smartphone-Based+Recognition+of+Human+Activities+and+Postural+Transitions">Smartphone-Based Recognition of Human Activities and Postural Transitions Data Set</a><span class="citation" data-cites="dataSource">(Reyes-Ortiz et al. <a href="#ref-dataSource">2016</a>)</span> distributed by the University of California, Irvine.</p>
<aside>
Throughout this post, <code>data/</code> is the directory created by downloading and unzipping this dataset.
</aside>
<p>When downloaded from the link above, the data contains two different âparts.â One that has been pre-processed using various feature extraction techniques such as fast-fourier transform, and another <code>RawData</code> section that simply supplies the raw X,Y,Z directions of an accelerometer and gyroscope. None of the standard noise filtering or feature extraction used in accelerometer data has been applied. This is the data set we will use.</p>
<p>The motivation for working with the raw data in this post is to aid the transition of the code/concepts to time series data in less well-characterized domains. While a more accurate model could be made by utilizing the filtered/cleaned data provided, the filtering and transformation can vary greatly from task to task; requiring lots of manual effort and domain knowledge. One of the beautiful things about deep learning is the feature extraction is learned from the data, not outside knowledge.</p>
<h3 id="activity-labels">Activity labels</h3>
<p>The data has integer encodings for the activities which, while not important to the model itself, are helpful for use to see. Letâs load them first.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
activityLabels &lt;- read.table(&quot;data/activity_labels.txt&quot;, 
                             col.names = c(&quot;number&quot;, &quot;label&quot;)) 

activityLabels %&gt;% kable(align = c(&quot;c&quot;, &quot;l&quot;))</code></pre>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">number</th>
<th style="text-align: left;">label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: left;">WALKING</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: left;">WALKING_UPSTAIRS</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: left;">WALKING_DOWNSTAIRS</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: left;">SITTING</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: left;">STANDING</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: left;">LAYING</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: left;">STAND_TO_SIT</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: left;">SIT_TO_STAND</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: left;">SIT_TO_LIE</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: left;">LIE_TO_SIT</td>
</tr>
<tr class="odd">
<td style="text-align: center;">11</td>
<td style="text-align: left;">STAND_TO_LIE</td>
</tr>
<tr class="even">
<td style="text-align: center;">12</td>
<td style="text-align: left;">LIE_TO_STAND</td>
</tr>
</tbody>
</table>
</div>
<p>Next, we load in the labels key for the <code>RawData</code>. This file is a list of all of the observations, or individual activity recordings, contained in the data set. The key for the columns is taken from the data <code>README.txt</code>.</p>
<pre><code>
Column 1: experiment number ID, 
Column 2: user number ID, 
Column 3: activity number ID 
Column 4: Label start point 
Column 5: Label end point </code></pre>
<p>The start and end points are in number of signal log samples (recorded at 50hz).</p>
<p>Letâs take a look at the first 50 rows:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<pre class="r"><code>
labels &lt;- read.table(
  &quot;data/RawData/labels.txt&quot;,
  col.names = c(&quot;experiment&quot;, &quot;userId&quot;, &quot;activity&quot;, &quot;startPos&quot;, &quot;endPos&quot;)
)

labels %&gt;% 
  head(50) %&gt;% 
  paged_table()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["experiment"],"name":[1],"type":["int"],"align":["right"]},{"label":["userId"],"name":[2],"type":["int"],"align":["right"]},{"label":["activity"],"name":[3],"type":["int"],"align":["right"]},{"label":["startPos"],"name":[4],"type":["int"],"align":["right"]},{"label":["endPos"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"1","3":"5","4":"250","5":"1232","_rn_":"1"},{"1":"1","2":"1","3":"7","4":"1233","5":"1392","_rn_":"2"},{"1":"1","2":"1","3":"4","4":"1393","5":"2194","_rn_":"3"},{"1":"1","2":"1","3":"8","4":"2195","5":"2359","_rn_":"4"},{"1":"1","2":"1","3":"5","4":"2360","5":"3374","_rn_":"5"},{"1":"1","2":"1","3":"11","4":"3375","5":"3662","_rn_":"6"},{"1":"1","2":"1","3":"6","4":"3663","5":"4538","_rn_":"7"},{"1":"1","2":"1","3":"10","4":"4539","5":"4735","_rn_":"8"},{"1":"1","2":"1","3":"4","4":"4736","5":"5667","_rn_":"9"},{"1":"1","2":"1","3":"9","4":"5668","5":"5859","_rn_":"10"},{"1":"1","2":"1","3":"6","4":"5860","5":"6786","_rn_":"11"},{"1":"1","2":"1","3":"12","4":"6787","5":"6977","_rn_":"12"},{"1":"1","2":"1","3":"1","4":"7496","5":"8078","_rn_":"13"},{"1":"1","2":"1","3":"1","4":"8356","5":"9250","_rn_":"14"},{"1":"1","2":"1","3":"1","4":"9657","5":"10567","_rn_":"15"},{"1":"1","2":"1","3":"1","4":"10750","5":"11714","_rn_":"16"},{"1":"1","2":"1","3":"3","4":"13191","5":"13846","_rn_":"17"},{"1":"1","2":"1","3":"2","4":"14069","5":"14699","_rn_":"18"},{"1":"1","2":"1","3":"3","4":"14869","5":"15492","_rn_":"19"},{"1":"1","2":"1","3":"2","4":"15712","5":"16377","_rn_":"20"},{"1":"1","2":"1","3":"3","4":"16530","5":"17153","_rn_":"21"},{"1":"1","2":"1","3":"2","4":"17298","5":"17970","_rn_":"22"},{"1":"2","2":"1","3":"5","4":"251","5":"1226","_rn_":"23"},{"1":"2","2":"1","3":"7","4":"1227","5":"1432","_rn_":"24"},{"1":"2","2":"1","3":"4","4":"1433","5":"2221","_rn_":"25"},{"1":"2","2":"1","3":"8","4":"2222","5":"2377","_rn_":"26"},{"1":"2","2":"1","3":"5","4":"2378","5":"3304","_rn_":"27"},{"1":"2","2":"1","3":"11","4":"3305","5":"3572","_rn_":"28"},{"1":"2","2":"1","3":"6","4":"3573","5":"4435","_rn_":"29"},{"1":"2","2":"1","3":"10","4":"4436","5":"4619","_rn_":"30"},{"1":"2","2":"1","3":"4","4":"4620","5":"5452","_rn_":"31"},{"1":"2","2":"1","3":"9","4":"5453","5":"5689","_rn_":"32"},{"1":"2","2":"1","3":"6","4":"5690","5":"6467","_rn_":"33"},{"1":"2","2":"1","3":"12","4":"6468","5":"6709","_rn_":"34"},{"1":"2","2":"1","3":"1","4":"7624","5":"8252","_rn_":"35"},{"1":"2","2":"1","3":"1","4":"8618","5":"9576","_rn_":"36"},{"1":"2","2":"1","3":"1","4":"9991","5":"10927","_rn_":"37"},{"1":"2","2":"1","3":"1","4":"11311","5":"12282","_rn_":"38"},{"1":"2","2":"1","3":"3","4":"13129","5":"13379","_rn_":"39"},{"1":"2","2":"1","3":"3","4":"13495","5":"13927","_rn_":"40"},{"1":"2","2":"1","3":"2","4":"14128","5":"14783","_rn_":"41"},{"1":"2","2":"1","3":"3","4":"15037","5":"15684","_rn_":"42"},{"1":"2","2":"1","3":"2","4":"15920","5":"16598","_rn_":"43"},{"1":"2","2":"1","3":"3","4":"16847","5":"17471","_rn_":"44"},{"1":"2","2":"1","3":"2","4":"17725","5":"18425","_rn_":"45"},{"1":"3","2":"2","3":"5","4":"298","5":"1398","_rn_":"46"},{"1":"3","2":"2","3":"7","4":"1399","5":"1555","_rn_":"47"},{"1":"3","2":"2","3":"4","4":"1686","5":"2627","_rn_":"48"},{"1":"3","2":"2","3":"8","4":"2628","5":"2769","_rn_":"49"},{"1":"3","2":"2","3":"5","4":"2770","5":"3904","_rn_":"50"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<h3 id="file-names">File names</h3>
<p>Next, letâs look at the actual files of the user data provided to us in <code>RawData/</code></p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
dataFiles &lt;- list.files(&quot;data/RawData&quot;)
dataFiles %&gt;% head()</code></pre>
<pre><code>
[1] &quot;acc_exp01_user01.txt&quot; &quot;acc_exp02_user01.txt&quot;
[3] &quot;acc_exp03_user02.txt&quot; &quot;acc_exp04_user02.txt&quot;
[5] &quot;acc_exp05_user03.txt&quot; &quot;acc_exp06_user03.txt&quot;</code></pre>
</div>
<p>There is a three-part file naming scheme. The first part is the type of data the file contains: either <code>acc</code> for accelerometer or <code>gyro</code> for gyroscope. Next is the experiment number, and last is the user Id for the recording. Letâs load these into a dataframe for ease of use later.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
fileInfo &lt;- data_frame(
  filePath = dataFiles
) %&gt;%
  filter(filePath != &quot;labels.txt&quot;) %&gt;% 
  separate(filePath, sep = &#39;_&#39;, 
           into = c(&quot;type&quot;, &quot;experiment&quot;, &quot;userId&quot;), 
           remove = FALSE) %&gt;% 
  mutate(
    experiment = str_remove(experiment, &quot;exp&quot;),
    userId = str_remove_all(userId, &quot;user|\\.txt&quot;)
  ) %&gt;% 
  spread(type, filePath)

fileInfo %&gt;% head() %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">experiment</th>
<th style="text-align: left;">userId</th>
<th style="text-align: left;">acc</th>
<th style="text-align: left;">gyro</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: left;">01</td>
<td style="text-align: left;">acc_exp01_user01.txt</td>
<td style="text-align: left;">gyro_exp01_user01.txt</td>
</tr>
<tr class="even">
<td style="text-align: left;">02</td>
<td style="text-align: left;">01</td>
<td style="text-align: left;">acc_exp02_user01.txt</td>
<td style="text-align: left;">gyro_exp02_user01.txt</td>
</tr>
<tr class="odd">
<td style="text-align: left;">03</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">acc_exp03_user02.txt</td>
<td style="text-align: left;">gyro_exp03_user02.txt</td>
</tr>
<tr class="even">
<td style="text-align: left;">04</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">acc_exp04_user02.txt</td>
<td style="text-align: left;">gyro_exp04_user02.txt</td>
</tr>
<tr class="odd">
<td style="text-align: left;">05</td>
<td style="text-align: left;">03</td>
<td style="text-align: left;">acc_exp05_user03.txt</td>
<td style="text-align: left;">gyro_exp05_user03.txt</td>
</tr>
<tr class="even">
<td style="text-align: left;">06</td>
<td style="text-align: left;">03</td>
<td style="text-align: left;">acc_exp06_user03.txt</td>
<td style="text-align: left;">gyro_exp06_user03.txt</td>
</tr>
</tbody>
</table>
</div>
<h3 id="reading-and-gathering-data">Reading and gathering data</h3>
<p>Before we can do anything with the data provided we need to get it into a model-friendly format. This means we want to have a list of observations, their class (or activity label), and the data corresponding to the recording.</p>
<p>To obtain this we will scan through each of the recording files present in <code>dataFiles</code>, look up what observations are contained in the recording, extract those recordings and return everything to an easy to model with dataframe.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Read contents of single file to a dataframe with accelerometer and gyro data.
readInData &lt;- function(experiment, userId){
  genFilePath = function(type) {
    paste0(&quot;data/RawData/&quot;, type, &quot;_exp&quot;,experiment, &quot;_user&quot;, userId, &quot;.txt&quot;)
  }  
  
  bind_cols(
    read.table(genFilePath(&quot;acc&quot;), col.names = c(&quot;a_x&quot;, &quot;a_y&quot;, &quot;a_z&quot;)),
    read.table(genFilePath(&quot;gyro&quot;), col.names = c(&quot;g_x&quot;, &quot;g_y&quot;, &quot;g_z&quot;))
  )
}

# Function to read a given file and get the observations contained along
# with their classes.

loadFileData &lt;- function(curExperiment, curUserId) {
  
  # load sensor data from file into dataframe
  allData &lt;- readInData(curExperiment, curUserId)

  extractObservation &lt;- function(startPos, endPos){
    allData[startPos:endPos,]
  }
  
  # get observation locations in this file from labels dataframe
  dataLabels &lt;- labels %&gt;% 
    filter(userId == as.integer(curUserId), 
           experiment == as.integer(curExperiment))
  

  # extract observations as dataframes and save as a column in dataframe.
  dataLabels %&gt;% 
    mutate(
      data = map2(startPos, endPos, extractObservation)
    ) %&gt;% 
    select(-startPos, -endPos)
}

# scan through all experiment and userId combos and gather data into a dataframe. 
allObservations &lt;- map2_df(fileInfo$experiment, fileInfo$userId, loadFileData) %&gt;% 
  right_join(activityLabels, by = c(&quot;activity&quot; = &quot;number&quot;)) %&gt;% 
  rename(activityName = label)

# cache work. 
write_rds(allObservations, &quot;allObservations.rds&quot;)
allObservations %&gt;% dim()</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>
[1] 1214    5</code></pre>
</div>
<h2 id="exploring-the-data">Exploring the data</h2>
<p>Now that we have all the data loaded along with the <code>experiment</code>, <code>userId</code>, and <code>activity</code> labels, we can explore the data set.</p>
<h3 id="length-of-recordings">Length of recordings</h3>
<p>Letâs first look at the length of the recordings by activity.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<pre class="r"><code>
allObservations %&gt;% 
  mutate(recording_length = map_int(data,nrow)) %&gt;% 
  ggplot(aes(x = recording_length, y = activityName)) +
  geom_density_ridges(alpha = 0.8)</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-8-1.png" width="576" /></p>
</div>
<p>The fact there is such a difference in length of recording between the different activity types requires us to be a bit careful with how we proceed. If we train the model on every class at once we are going to have to pad all the observations to the length of the longest, which would leave a large majority of the observations with a huge proportion of their data being just padding-zeros. Because of this, we will fit our model to just the largest âgroupâ of observations length activities, these include <code>STAND_TO_SIT</code>, <code>STAND_TO_LIE</code>, <code>SIT_TO_STAND</code>, <code>SIT_TO_LIE</code>, <code>LIE_TO_STAND</code>, and <code>LIE_TO_SIT</code>.</p>
<aside>
It is notable that the activities that we have selected here are all âtransitions.â So in a way we are creating a change-point detection algorithm.
</aside>
<p>An interesting future direction would be attempting to use another architecture such as an RNN that can handle variable length inputs and training it on all the data. However, you would run the risk of the model learning simply that if the observation is long it is most likely one of the four longest classes which would not generalize to a scenario where you were running this model on a real-time-stream of data.</p>
<h3 id="filtering-activities">Filtering activities</h3>
<p>Based on our work from above, letâs subset the data to just be of the activities of interest.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<pre class="r"><code>
desiredActivities &lt;- c(
  &quot;STAND_TO_SIT&quot;, &quot;SIT_TO_STAND&quot;, &quot;SIT_TO_LIE&quot;, 
  &quot;LIE_TO_SIT&quot;, &quot;STAND_TO_LIE&quot;, &quot;LIE_TO_STAND&quot;  
)

filteredObservations &lt;- allObservations %&gt;% 
  filter(activityName %in% desiredActivities) %&gt;% 
  mutate(observationId = 1:n())

filteredObservations %&gt;% paged_table()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["experiment"],"name":[1],"type":["int"],"align":["right"]},{"label":["userId"],"name":[2],"type":["int"],"align":["right"]},{"label":["activity"],"name":[3],"type":["int"],"align":["right"]},{"label":["data"],"name":[4],"type":["list"],"align":["right"]},{"label":["activityName"],"name":[5],"type":["fctr"],"align":["left"]},{"label":["observationId"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"1","3":"7","4":"<data.frame [160 Ã 6]>","5":"STAND_TO_SIT","6":"1"},{"1":"2","2":"1","3":"7","4":"<data.frame [206 Ã 6]>","5":"STAND_TO_SIT","6":"2"},{"1":"3","2":"2","3":"7","4":"<data.frame [157 Ã 6]>","5":"STAND_TO_SIT","6":"3"},{"1":"4","2":"2","3":"7","4":"<data.frame [160 Ã 6]>","5":"STAND_TO_SIT","6":"4"},{"1":"5","2":"3","3":"7","4":"<data.frame [142 Ã 6]>","5":"STAND_TO_SIT","6":"5"},{"1":"6","2":"3","3":"7","4":"<data.frame [190 Ã 6]>","5":"STAND_TO_SIT","6":"6"},{"1":"7","2":"4","3":"7","4":"<data.frame [236 Ã 6]>","5":"STAND_TO_SIT","6":"7"},{"1":"8","2":"4","3":"7","4":"<data.frame [178 Ã 6]>","5":"STAND_TO_SIT","6":"8"},{"1":"9","2":"5","3":"7","4":"<data.frame [165 Ã 6]>","5":"STAND_TO_SIT","6":"9"},{"1":"10","2":"5","3":"7","4":"<data.frame [235 Ã 6]>","5":"STAND_TO_SIT","6":"10"},{"1":"11","2":"6","3":"7","4":"<data.frame [185 Ã 6]>","5":"STAND_TO_SIT","6":"11"},{"1":"12","2":"6","3":"7","4":"<data.frame [151 Ã 6]>","5":"STAND_TO_SIT","6":"12"},{"1":"13","2":"7","3":"7","4":"<data.frame [114 Ã 6]>","5":"STAND_TO_SIT","6":"13"},{"1":"14","2":"7","3":"7","4":"<data.frame [90 Ã 6]>","5":"STAND_TO_SIT","6":"14"},{"1":"15","2":"8","3":"7","4":"<data.frame [111 Ã 6]>","5":"STAND_TO_SIT","6":"15"},{"1":"16","2":"8","3":"7","4":"<data.frame [129 Ã 6]>","5":"STAND_TO_SIT","6":"16"},{"1":"17","2":"9","3":"7","4":"<data.frame [118 Ã 6]>","5":"STAND_TO_SIT","6":"17"},{"1":"18","2":"9","3":"7","4":"<data.frame [132 Ã 6]>","5":"STAND_TO_SIT","6":"18"},{"1":"19","2":"10","3":"7","4":"<data.frame [133 Ã 6]>","5":"STAND_TO_SIT","6":"19"},{"1":"20","2":"10","3":"7","4":"<data.frame [112 Ã 6]>","5":"STAND_TO_SIT","6":"20"},{"1":"22","2":"11","3":"7","4":"<data.frame [141 Ã 6]>","5":"STAND_TO_SIT","6":"21"},{"1":"23","2":"11","3":"7","4":"<data.frame [172 Ã 6]>","5":"STAND_TO_SIT","6":"22"},{"1":"24","2":"12","3":"7","4":"<data.frame [175 Ã 6]>","5":"STAND_TO_SIT","6":"23"},{"1":"25","2":"12","3":"7","4":"<data.frame [190 Ã 6]>","5":"STAND_TO_SIT","6":"24"},{"1":"26","2":"13","3":"7","4":"<data.frame [138 Ã 6]>","5":"STAND_TO_SIT","6":"25"},{"1":"27","2":"13","3":"7","4":"<data.frame [250 Ã 6]>","5":"STAND_TO_SIT","6":"26"},{"1":"28","2":"14","3":"7","4":"<data.frame [298 Ã 6]>","5":"STAND_TO_SIT","6":"27"},{"1":"29","2":"14","3":"7","4":"<data.frame [177 Ã 6]>","5":"STAND_TO_SIT","6":"28"},{"1":"30","2":"15","3":"7","4":"<data.frame [144 Ã 6]>","5":"STAND_TO_SIT","6":"29"},{"1":"31","2":"15","3":"7","4":"<data.frame [138 Ã 6]>","5":"STAND_TO_SIT","6":"30"},{"1":"32","2":"16","3":"7","4":"<data.frame [180 Ã 6]>","5":"STAND_TO_SIT","6":"31"},{"1":"33","2":"16","3":"7","4":"<data.frame [175 Ã 6]>","5":"STAND_TO_SIT","6":"32"},{"1":"34","2":"17","3":"7","4":"<data.frame [142 Ã 6]>","5":"STAND_TO_SIT","6":"33"},{"1":"35","2":"17","3":"7","4":"<data.frame [154 Ã 6]>","5":"STAND_TO_SIT","6":"34"},{"1":"36","2":"18","3":"7","4":"<data.frame [307 Ã 6]>","5":"STAND_TO_SIT","6":"35"},{"1":"37","2":"18","3":"7","4":"<data.frame [227 Ã 6]>","5":"STAND_TO_SIT","6":"36"},{"1":"38","2":"19","3":"7","4":"<data.frame [179 Ã 6]>","5":"STAND_TO_SIT","6":"37"},{"1":"39","2":"19","3":"7","4":"<data.frame [163 Ã 6]>","5":"STAND_TO_SIT","6":"38"},{"1":"40","2":"20","3":"7","4":"<data.frame [201 Ã 6]>","5":"STAND_TO_SIT","6":"39"},{"1":"41","2":"20","3":"7","4":"<data.frame [219 Ã 6]>","5":"STAND_TO_SIT","6":"40"},{"1":"42","2":"21","3":"7","4":"<data.frame [177 Ã 6]>","5":"STAND_TO_SIT","6":"41"},{"1":"43","2":"21","3":"7","4":"<data.frame [140 Ã 6]>","5":"STAND_TO_SIT","6":"42"},{"1":"44","2":"22","3":"7","4":"<data.frame [214 Ã 6]>","5":"STAND_TO_SIT","6":"43"},{"1":"45","2":"22","3":"7","4":"<data.frame [119 Ã 6]>","5":"STAND_TO_SIT","6":"44"},{"1":"46","2":"23","3":"7","4":"<data.frame [143 Ã 6]>","5":"STAND_TO_SIT","6":"45"},{"1":"47","2":"23","3":"7","4":"<data.frame [222 Ã 6]>","5":"STAND_TO_SIT","6":"46"},{"1":"48","2":"24","3":"7","4":"<data.frame [171 Ã 6]>","5":"STAND_TO_SIT","6":"47"},{"1":"49","2":"24","3":"7","4":"<data.frame [187 Ã 6]>","5":"STAND_TO_SIT","6":"48"},{"1":"50","2":"25","3":"7","4":"<data.frame [138 Ã 6]>","5":"STAND_TO_SIT","6":"49"},{"1":"51","2":"25","3":"7","4":"<data.frame [219 Ã 6]>","5":"STAND_TO_SIT","6":"50"},{"1":"52","2":"26","3":"7","4":"<data.frame [129 Ã 6]>","5":"STAND_TO_SIT","6":"51"},{"1":"53","2":"26","3":"7","4":"<data.frame [151 Ã 6]>","5":"STAND_TO_SIT","6":"52"},{"1":"54","2":"27","3":"7","4":"<data.frame [168 Ã 6]>","5":"STAND_TO_SIT","6":"53"},{"1":"55","2":"27","3":"7","4":"<data.frame [188 Ã 6]>","5":"STAND_TO_SIT","6":"54"},{"1":"56","2":"28","3":"7","4":"<data.frame [259 Ã 6]>","5":"STAND_TO_SIT","6":"55"},{"1":"57","2":"28","3":"7","4":"<data.frame [162 Ã 6]>","5":"STAND_TO_SIT","6":"56"},{"1":"58","2":"29","3":"7","4":"<data.frame [157 Ã 6]>","5":"STAND_TO_SIT","6":"57"},{"1":"59","2":"29","3":"7","4":"<data.frame [169 Ã 6]>","5":"STAND_TO_SIT","6":"58"},{"1":"60","2":"30","3":"7","4":"<data.frame [113 Ã 6]>","5":"STAND_TO_SIT","6":"59"},{"1":"61","2":"30","3":"7","4":"<data.frame [216 Ã 6]>","5":"STAND_TO_SIT","6":"60"},{"1":"1","2":"1","3":"8","4":"<data.frame [165 Ã 6]>","5":"SIT_TO_STAND","6":"61"},{"1":"2","2":"1","3":"8","4":"<data.frame [156 Ã 6]>","5":"SIT_TO_STAND","6":"62"},{"1":"3","2":"2","3":"8","4":"<data.frame [142 Ã 6]>","5":"SIT_TO_STAND","6":"63"},{"1":"4","2":"2","3":"8","4":"<data.frame [139 Ã 6]>","5":"SIT_TO_STAND","6":"64"},{"1":"5","2":"3","3":"8","4":"<data.frame [110 Ã 6]>","5":"SIT_TO_STAND","6":"65"},{"1":"6","2":"3","3":"8","4":"<data.frame [183 Ã 6]>","5":"SIT_TO_STAND","6":"66"},{"1":"7","2":"4","3":"8","4":"<data.frame [130 Ã 6]>","5":"SIT_TO_STAND","6":"67"},{"1":"8","2":"4","3":"8","4":"<data.frame [143 Ã 6]>","5":"SIT_TO_STAND","6":"68"},{"1":"9","2":"5","3":"8","4":"<data.frame [126 Ã 6]>","5":"SIT_TO_STAND","6":"69"},{"1":"10","2":"5","3":"8","4":"<data.frame [129 Ã 6]>","5":"SIT_TO_STAND","6":"70"},{"1":"11","2":"6","3":"8","4":"<data.frame [114 Ã 6]>","5":"SIT_TO_STAND","6":"71"},{"1":"12","2":"6","3":"8","4":"<data.frame [132 Ã 6]>","5":"SIT_TO_STAND","6":"72"},{"1":"13","2":"7","3":"8","4":"<data.frame [93 Ã 6]>","5":"SIT_TO_STAND","6":"73"},{"1":"14","2":"7","3":"8","4":"<data.frame [74 Ã 6]>","5":"SIT_TO_STAND","6":"74"},{"1":"15","2":"8","3":"8","4":"<data.frame [74 Ã 6]>","5":"SIT_TO_STAND","6":"75"},{"1":"16","2":"8","3":"8","4":"<data.frame [114 Ã 6]>","5":"SIT_TO_STAND","6":"76"},{"1":"16","2":"8","3":"8","4":"<data.frame [117 Ã 6]>","5":"SIT_TO_STAND","6":"77"},{"1":"17","2":"9","3":"8","4":"<data.frame [106 Ã 6]>","5":"SIT_TO_STAND","6":"78"},{"1":"18","2":"9","3":"8","4":"<data.frame [97 Ã 6]>","5":"SIT_TO_STAND","6":"79"},{"1":"19","2":"10","3":"8","4":"<data.frame [89 Ã 6]>","5":"SIT_TO_STAND","6":"80"},{"1":"20","2":"10","3":"8","4":"<data.frame [78 Ã 6]>","5":"SIT_TO_STAND","6":"81"},{"1":"22","2":"11","3":"8","4":"<data.frame [132 Ã 6]>","5":"SIT_TO_STAND","6":"82"},{"1":"23","2":"11","3":"8","4":"<data.frame [132 Ã 6]>","5":"SIT_TO_STAND","6":"83"},{"1":"24","2":"12","3":"8","4":"<data.frame [104 Ã 6]>","5":"SIT_TO_STAND","6":"84"},{"1":"25","2":"12","3":"8","4":"<data.frame [138 Ã 6]>","5":"SIT_TO_STAND","6":"85"},{"1":"26","2":"13","3":"8","4":"<data.frame [142 Ã 6]>","5":"SIT_TO_STAND","6":"86"},{"1":"27","2":"13","3":"8","4":"<data.frame [159 Ã 6]>","5":"SIT_TO_STAND","6":"87"},{"1":"28","2":"14","3":"8","4":"<data.frame [136 Ã 6]>","5":"SIT_TO_STAND","6":"88"},{"1":"29","2":"14","3":"8","4":"<data.frame [140 Ã 6]>","5":"SIT_TO_STAND","6":"89"},{"1":"30","2":"15","3":"8","4":"<data.frame [110 Ã 6]>","5":"SIT_TO_STAND","6":"90"},{"1":"31","2":"15","3":"8","4":"<data.frame [153 Ã 6]>","5":"SIT_TO_STAND","6":"91"},{"1":"32","2":"16","3":"8","4":"<data.frame [109 Ã 6]>","5":"SIT_TO_STAND","6":"92"},{"1":"33","2":"16","3":"8","4":"<data.frame [109 Ã 6]>","5":"SIT_TO_STAND","6":"93"},{"1":"34","2":"17","3":"8","4":"<data.frame [153 Ã 6]>","5":"SIT_TO_STAND","6":"94"},{"1":"35","2":"17","3":"8","4":"<data.frame [158 Ã 6]>","5":"SIT_TO_STAND","6":"95"},{"1":"36","2":"18","3":"8","4":"<data.frame [182 Ã 6]>","5":"SIT_TO_STAND","6":"96"},{"1":"37","2":"18","3":"8","4":"<data.frame [176 Ã 6]>","5":"SIT_TO_STAND","6":"97"},{"1":"38","2":"19","3":"8","4":"<data.frame [135 Ã 6]>","5":"SIT_TO_STAND","6":"98"},{"1":"39","2":"19","3":"8","4":"<data.frame [122 Ã 6]>","5":"SIT_TO_STAND","6":"99"},{"1":"40","2":"20","3":"8","4":"<data.frame [182 Ã 6]>","5":"SIT_TO_STAND","6":"100"},{"1":"41","2":"20","3":"8","4":"<data.frame [121 Ã 6]>","5":"SIT_TO_STAND","6":"101"},{"1":"42","2":"21","3":"8","4":"<data.frame [146 Ã 6]>","5":"SIT_TO_STAND","6":"102"},{"1":"43","2":"21","3":"8","4":"<data.frame [118 Ã 6]>","5":"SIT_TO_STAND","6":"103"},{"1":"44","2":"22","3":"8","4":"<data.frame [104 Ã 6]>","5":"SIT_TO_STAND","6":"104"},{"1":"45","2":"22","3":"8","4":"<data.frame [106 Ã 6]>","5":"SIT_TO_STAND","6":"105"},{"1":"45","2":"22","3":"8","4":"<data.frame [92 Ã 6]>","5":"SIT_TO_STAND","6":"106"},{"1":"46","2":"23","3":"8","4":"<data.frame [121 Ã 6]>","5":"SIT_TO_STAND","6":"107"},{"1":"47","2":"23","3":"8","4":"<data.frame [150 Ã 6]>","5":"SIT_TO_STAND","6":"108"},{"1":"48","2":"24","3":"8","4":"<data.frame [109 Ã 6]>","5":"SIT_TO_STAND","6":"109"},{"1":"49","2":"24","3":"8","4":"<data.frame [124 Ã 6]>","5":"SIT_TO_STAND","6":"110"},{"1":"50","2":"25","3":"8","4":"<data.frame [152 Ã 6]>","5":"SIT_TO_STAND","6":"111"},{"1":"51","2":"25","3":"8","4":"<data.frame [173 Ã 6]>","5":"SIT_TO_STAND","6":"112"},{"1":"52","2":"26","3":"8","4":"<data.frame [182 Ã 6]>","5":"SIT_TO_STAND","6":"113"},{"1":"53","2":"26","3":"8","4":"<data.frame [102 Ã 6]>","5":"SIT_TO_STAND","6":"114"},{"1":"54","2":"27","3":"8","4":"<data.frame [98 Ã 6]>","5":"SIT_TO_STAND","6":"115"},{"1":"55","2":"27","3":"8","4":"<data.frame [101 Ã 6]>","5":"SIT_TO_STAND","6":"116"},{"1":"56","2":"28","3":"8","4":"<data.frame [138 Ã 6]>","5":"SIT_TO_STAND","6":"117"},{"1":"57","2":"28","3":"8","4":"<data.frame [121 Ã 6]>","5":"SIT_TO_STAND","6":"118"},{"1":"58","2":"29","3":"8","4":"<data.frame [175 Ã 6]>","5":"SIT_TO_STAND","6":"119"},{"1":"59","2":"29","3":"8","4":"<data.frame [134 Ã 6]>","5":"SIT_TO_STAND","6":"120"},{"1":"60","2":"30","3":"8","4":"<data.frame [151 Ã 6]>","5":"SIT_TO_STAND","6":"121"},{"1":"61","2":"30","3":"8","4":"<data.frame [128 Ã 6]>","5":"SIT_TO_STAND","6":"122"},{"1":"1","2":"1","3":"9","4":"<data.frame [192 Ã 6]>","5":"SIT_TO_LIE","6":"123"},{"1":"2","2":"1","3":"9","4":"<data.frame [237 Ã 6]>","5":"SIT_TO_LIE","6":"124"},{"1":"3","2":"2","3":"9","4":"<data.frame [225 Ã 6]>","5":"SIT_TO_LIE","6":"125"},{"1":"4","2":"2","3":"9","4":"<data.frame [154 Ã 6]>","5":"SIT_TO_LIE","6":"126"},{"1":"5","2":"3","3":"9","4":"<data.frame [151 Ã 6]>","5":"SIT_TO_LIE","6":"127"},{"1":"6","2":"3","3":"9","4":"<data.frame [170 Ã 6]>","5":"SIT_TO_LIE","6":"128"},{"1":"7","2":"4","3":"9","4":"<data.frame [224 Ã 6]>","5":"SIT_TO_LIE","6":"129"},{"1":"8","2":"4","3":"9","4":"<data.frame [235 Ã 6]>","5":"SIT_TO_LIE","6":"130"},{"1":"9","2":"5","3":"9","4":"<data.frame [220 Ã 6]>","5":"SIT_TO_LIE","6":"131"},{"1":"10","2":"5","3":"9","4":"<data.frame [259 Ã 6]>","5":"SIT_TO_LIE","6":"132"},{"1":"11","2":"6","3":"9","4":"<data.frame [158 Ã 6]>","5":"SIT_TO_LIE","6":"133"},{"1":"12","2":"6","3":"9","4":"<data.frame [158 Ã 6]>","5":"SIT_TO_LIE","6":"134"},{"1":"13","2":"7","3":"9","4":"<data.frame [257 Ã 6]>","5":"SIT_TO_LIE","6":"135"},{"1":"14","2":"7","3":"9","4":"<data.frame [189 Ã 6]>","5":"SIT_TO_LIE","6":"136"},{"1":"15","2":"8","3":"9","4":"<data.frame [166 Ã 6]>","5":"SIT_TO_LIE","6":"137"},{"1":"16","2":"8","3":"9","4":"<data.frame [147 Ã 6]>","5":"SIT_TO_LIE","6":"138"},{"1":"17","2":"9","3":"9","4":"<data.frame [204 Ã 6]>","5":"SIT_TO_LIE","6":"139"},{"1":"18","2":"9","3":"9","4":"<data.frame [161 Ã 6]>","5":"SIT_TO_LIE","6":"140"},{"1":"19","2":"10","3":"9","4":"<data.frame [181 Ã 6]>","5":"SIT_TO_LIE","6":"141"},{"1":"20","2":"10","3":"9","4":"<data.frame [159 Ã 6]>","5":"SIT_TO_LIE","6":"142"},{"1":"22","2":"11","3":"9","4":"<data.frame [185 Ã 6]>","5":"SIT_TO_LIE","6":"143"},{"1":"23","2":"11","3":"9","4":"<data.frame [198 Ã 6]>","5":"SIT_TO_LIE","6":"144"},{"1":"24","2":"12","3":"9","4":"<data.frame [173 Ã 6]>","5":"SIT_TO_LIE","6":"145"},{"1":"25","2":"12","3":"9","4":"<data.frame [182 Ã 6]>","5":"SIT_TO_LIE","6":"146"},{"1":"26","2":"13","3":"9","4":"<data.frame [226 Ã 6]>","5":"SIT_TO_LIE","6":"147"},{"1":"27","2":"13","3":"9","4":"<data.frame [212 Ã 6]>","5":"SIT_TO_LIE","6":"148"},{"1":"28","2":"14","3":"9","4":"<data.frame [289 Ã 6]>","5":"SIT_TO_LIE","6":"149"},{"1":"29","2":"14","3":"9","4":"<data.frame [172 Ã 6]>","5":"SIT_TO_LIE","6":"150"},{"1":"30","2":"15","3":"9","4":"<data.frame [202 Ã 6]>","5":"SIT_TO_LIE","6":"151"},{"1":"31","2":"15","3":"9","4":"<data.frame [205 Ã 6]>","5":"SIT_TO_LIE","6":"152"},{"1":"32","2":"16","3":"9","4":"<data.frame [195 Ã 6]>","5":"SIT_TO_LIE","6":"153"},{"1":"33","2":"16","3":"9","4":"<data.frame [181 Ã 6]>","5":"SIT_TO_LIE","6":"154"},{"1":"34","2":"17","3":"9","4":"<data.frame [312 Ã 6]>","5":"SIT_TO_LIE","6":"155"},{"1":"35","2":"17","3":"9","4":"<data.frame [202 Ã 6]>","5":"SIT_TO_LIE","6":"156"},{"1":"36","2":"18","3":"9","4":"<data.frame [251 Ã 6]>","5":"SIT_TO_LIE","6":"157"},{"1":"37","2":"18","3":"9","4":"<data.frame [199 Ã 6]>","5":"SIT_TO_LIE","6":"158"},{"1":"38","2":"19","3":"9","4":"<data.frame [176 Ã 6]>","5":"SIT_TO_LIE","6":"159"},{"1":"39","2":"19","3":"9","4":"<data.frame [203 Ã 6]>","5":"SIT_TO_LIE","6":"160"},{"1":"40","2":"20","3":"9","4":"<data.frame [297 Ã 6]>","5":"SIT_TO_LIE","6":"161"},{"1":"41","2":"20","3":"9","4":"<data.frame [281 Ã 6]>","5":"SIT_TO_LIE","6":"162"},{"1":"42","2":"21","3":"9","4":"<data.frame [202 Ã 6]>","5":"SIT_TO_LIE","6":"163"},{"1":"43","2":"21","3":"9","4":"<data.frame [212 Ã 6]>","5":"SIT_TO_LIE","6":"164"},{"1":"44","2":"22","3":"9","4":"<data.frame [136 Ã 6]>","5":"SIT_TO_LIE","6":"165"},{"1":"45","2":"22","3":"9","4":"<data.frame [159 Ã 6]>","5":"SIT_TO_LIE","6":"166"},{"1":"46","2":"23","3":"9","4":"<data.frame [213 Ã 6]>","5":"SIT_TO_LIE","6":"167"},{"1":"47","2":"23","3":"9","4":"<data.frame [219 Ã 6]>","5":"SIT_TO_LIE","6":"168"},{"1":"48","2":"24","3":"9","4":"<data.frame [234 Ã 6]>","5":"SIT_TO_LIE","6":"169"},{"1":"49","2":"24","3":"9","4":"<data.frame [206 Ã 6]>","5":"SIT_TO_LIE","6":"170"},{"1":"50","2":"25","3":"9","4":"<data.frame [199 Ã 6]>","5":"SIT_TO_LIE","6":"171"},{"1":"51","2":"25","3":"9","4":"<data.frame [181 Ã 6]>","5":"SIT_TO_LIE","6":"172"},{"1":"52","2":"26","3":"9","4":"<data.frame [185 Ã 6]>","5":"SIT_TO_LIE","6":"173"},{"1":"53","2":"26","3":"9","4":"<data.frame [213 Ã 6]>","5":"SIT_TO_LIE","6":"174"},{"1":"54","2":"27","3":"9","4":"<data.frame [227 Ã 6]>","5":"SIT_TO_LIE","6":"175"},{"1":"55","2":"27","3":"9","4":"<data.frame [225 Ã 6]>","5":"SIT_TO_LIE","6":"176"},{"1":"56","2":"28","3":"9","4":"<data.frame [226 Ã 6]>","5":"SIT_TO_LIE","6":"177"},{"1":"57","2":"28","3":"9","4":"<data.frame [201 Ã 6]>","5":"SIT_TO_LIE","6":"178"},{"1":"58","2":"29","3":"9","4":"<data.frame [326 Ã 6]>","5":"SIT_TO_LIE","6":"179"},{"1":"59","2":"29","3":"9","4":"<data.frame [201 Ã 6]>","5":"SIT_TO_LIE","6":"180"},{"1":"60","2":"30","3":"9","4":"<data.frame [183 Ã 6]>","5":"SIT_TO_LIE","6":"181"},{"1":"61","2":"30","3":"9","4":"<data.frame [292 Ã 6]>","5":"SIT_TO_LIE","6":"182"},{"1":"1","2":"1","3":"10","4":"<data.frame [197 Ã 6]>","5":"LIE_TO_SIT","6":"183"},{"1":"2","2":"1","3":"10","4":"<data.frame [184 Ã 6]>","5":"LIE_TO_SIT","6":"184"},{"1":"3","2":"2","3":"10","4":"<data.frame [278 Ã 6]>","5":"LIE_TO_SIT","6":"185"},{"1":"4","2":"2","3":"10","4":"<data.frame [142 Ã 6]>","5":"LIE_TO_SIT","6":"186"},{"1":"5","2":"3","3":"10","4":"<data.frame [224 Ã 6]>","5":"LIE_TO_SIT","6":"187"},{"1":"6","2":"3","3":"10","4":"<data.frame [197 Ã 6]>","5":"LIE_TO_SIT","6":"188"},{"1":"7","2":"4","3":"10","4":"<data.frame [215 Ã 6]>","5":"LIE_TO_SIT","6":"189"},{"1":"8","2":"4","3":"10","4":"<data.frame [210 Ã 6]>","5":"LIE_TO_SIT","6":"190"},{"1":"9","2":"5","3":"10","4":"<data.frame [256 Ã 6]>","5":"LIE_TO_SIT","6":"191"},{"1":"10","2":"5","3":"10","4":"<data.frame [203 Ã 6]>","5":"LIE_TO_SIT","6":"192"},{"1":"11","2":"6","3":"10","4":"<data.frame [173 Ã 6]>","5":"LIE_TO_SIT","6":"193"},{"1":"12","2":"6","3":"10","4":"<data.frame [165 Ã 6]>","5":"LIE_TO_SIT","6":"194"},{"1":"13","2":"7","3":"10","4":"<data.frame [146 Ã 6]>","5":"LIE_TO_SIT","6":"195"},{"1":"14","2":"7","3":"10","4":"<data.frame [123 Ã 6]>","5":"LIE_TO_SIT","6":"196"},{"1":"15","2":"8","3":"10","4":"<data.frame [160 Ã 6]>","5":"LIE_TO_SIT","6":"197"},{"1":"16","2":"8","3":"10","4":"<data.frame [136 Ã 6]>","5":"LIE_TO_SIT","6":"198"},{"1":"16","2":"8","3":"10","4":"<data.frame [165 Ã 6]>","5":"LIE_TO_SIT","6":"199"},{"1":"17","2":"9","3":"10","4":"<data.frame [177 Ã 6]>","5":"LIE_TO_SIT","6":"200"},{"1":"18","2":"9","3":"10","4":"<data.frame [128 Ã 6]>","5":"LIE_TO_SIT","6":"201"},{"1":"19","2":"10","3":"10","4":"<data.frame [169 Ã 6]>","5":"LIE_TO_SIT","6":"202"},{"1":"20","2":"10","3":"10","4":"<data.frame [114 Ã 6]>","5":"LIE_TO_SIT","6":"203"},{"1":"22","2":"11","3":"10","4":"<data.frame [179 Ã 6]>","5":"LIE_TO_SIT","6":"204"},{"1":"23","2":"11","3":"10","4":"<data.frame [222 Ã 6]>","5":"LIE_TO_SIT","6":"205"},{"1":"24","2":"12","3":"10","4":"<data.frame [178 Ã 6]>","5":"LIE_TO_SIT","6":"206"},{"1":"25","2":"12","3":"10","4":"<data.frame [179 Ã 6]>","5":"LIE_TO_SIT","6":"207"},{"1":"26","2":"13","3":"10","4":"<data.frame [190 Ã 6]>","5":"LIE_TO_SIT","6":"208"},{"1":"27","2":"13","3":"10","4":"<data.frame [193 Ã 6]>","5":"LIE_TO_SIT","6":"209"},{"1":"28","2":"14","3":"10","4":"<data.frame [226 Ã 6]>","5":"LIE_TO_SIT","6":"210"},{"1":"29","2":"14","3":"10","4":"<data.frame [147 Ã 6]>","5":"LIE_TO_SIT","6":"211"},{"1":"30","2":"15","3":"10","4":"<data.frame [166 Ã 6]>","5":"LIE_TO_SIT","6":"212"},{"1":"31","2":"15","3":"10","4":"<data.frame [169 Ã 6]>","5":"LIE_TO_SIT","6":"213"},{"1":"32","2":"16","3":"10","4":"<data.frame [184 Ã 6]>","5":"LIE_TO_SIT","6":"214"},{"1":"33","2":"16","3":"10","4":"<data.frame [183 Ã 6]>","5":"LIE_TO_SIT","6":"215"},{"1":"34","2":"17","3":"10","4":"<data.frame [211 Ã 6]>","5":"LIE_TO_SIT","6":"216"},{"1":"35","2":"17","3":"10","4":"<data.frame [271 Ã 6]>","5":"LIE_TO_SIT","6":"217"},{"1":"36","2":"18","3":"10","4":"<data.frame [245 Ã 6]>","5":"LIE_TO_SIT","6":"218"},{"1":"37","2":"18","3":"10","4":"<data.frame [165 Ã 6]>","5":"LIE_TO_SIT","6":"219"},{"1":"38","2":"19","3":"10","4":"<data.frame [197 Ã 6]>","5":"LIE_TO_SIT","6":"220"},{"1":"39","2":"19","3":"10","4":"<data.frame [150 Ã 6]>","5":"LIE_TO_SIT","6":"221"},{"1":"40","2":"20","3":"10","4":"<data.frame [156 Ã 6]>","5":"LIE_TO_SIT","6":"222"},{"1":"41","2":"20","3":"10","4":"<data.frame [192 Ã 6]>","5":"LIE_TO_SIT","6":"223"},{"1":"42","2":"21","3":"10","4":"<data.frame [204 Ã 6]>","5":"LIE_TO_SIT","6":"224"},{"1":"43","2":"21","3":"10","4":"<data.frame [196 Ã 6]>","5":"LIE_TO_SIT","6":"225"},{"1":"44","2":"22","3":"10","4":"<data.frame [185 Ã 6]>","5":"LIE_TO_SIT","6":"226"},{"1":"45","2":"22","3":"10","4":"<data.frame [161 Ã 6]>","5":"LIE_TO_SIT","6":"227"},{"1":"45","2":"22","3":"10","4":"<data.frame [157 Ã 6]>","5":"LIE_TO_SIT","6":"228"},{"1":"46","2":"23","3":"10","4":"<data.frame [174 Ã 6]>","5":"LIE_TO_SIT","6":"229"},{"1":"47","2":"23","3":"10","4":"<data.frame [171 Ã 6]>","5":"LIE_TO_SIT","6":"230"},{"1":"48","2":"24","3":"10","4":"<data.frame [210 Ã 6]>","5":"LIE_TO_SIT","6":"231"},{"1":"49","2":"24","3":"10","4":"<data.frame [180 Ã 6]>","5":"LIE_TO_SIT","6":"232"},{"1":"50","2":"25","3":"10","4":"<data.frame [280 Ã 6]>","5":"LIE_TO_SIT","6":"233"},{"1":"51","2":"25","3":"10","4":"<data.frame [215 Ã 6]>","5":"LIE_TO_SIT","6":"234"},{"1":"52","2":"26","3":"10","4":"<data.frame [162 Ã 6]>","5":"LIE_TO_SIT","6":"235"},{"1":"53","2":"26","3":"10","4":"<data.frame [174 Ã 6]>","5":"LIE_TO_SIT","6":"236"},{"1":"54","2":"27","3":"10","4":"<data.frame [154 Ã 6]>","5":"LIE_TO_SIT","6":"237"},{"1":"55","2":"27","3":"10","4":"<data.frame [149 Ã 6]>","5":"LIE_TO_SIT","6":"238"},{"1":"58","2":"29","3":"10","4":"<data.frame [237 Ã 6]>","5":"LIE_TO_SIT","6":"239"},{"1":"59","2":"29","3":"10","4":"<data.frame [170 Ã 6]>","5":"LIE_TO_SIT","6":"240"},{"1":"60","2":"30","3":"10","4":"<data.frame [167 Ã 6]>","5":"LIE_TO_SIT","6":"241"},{"1":"61","2":"30","3":"10","4":"<data.frame [239 Ã 6]>","5":"LIE_TO_SIT","6":"242"},{"1":"1","2":"1","3":"11","4":"<data.frame [288 Ã 6]>","5":"STAND_TO_LIE","6":"243"},{"1":"2","2":"1","3":"11","4":"<data.frame [268 Ã 6]>","5":"STAND_TO_LIE","6":"244"},{"1":"3","2":"2","3":"11","4":"<data.frame [418 Ã 6]>","5":"STAND_TO_LIE","6":"245"},{"1":"4","2":"2","3":"11","4":"<data.frame [205 Ã 6]>","5":"STAND_TO_LIE","6":"246"},{"1":"5","2":"3","3":"11","4":"<data.frame [216 Ã 6]>","5":"STAND_TO_LIE","6":"247"},{"1":"6","2":"3","3":"11","4":"<data.frame [235 Ã 6]>","5":"STAND_TO_LIE","6":"248"},{"1":"7","2":"4","3":"11","4":"<data.frame [332 Ã 6]>","5":"STAND_TO_LIE","6":"249"},{"1":"8","2":"4","3":"11","4":"<data.frame [319 Ã 6]>","5":"STAND_TO_LIE","6":"250"},{"1":"9","2":"5","3":"11","4":"<data.frame [346 Ã 6]>","5":"STAND_TO_LIE","6":"251"},{"1":"10","2":"5","3":"11","4":"<data.frame [315 Ã 6]>","5":"STAND_TO_LIE","6":"252"},{"1":"11","2":"6","3":"11","4":"<data.frame [313 Ã 6]>","5":"STAND_TO_LIE","6":"253"},{"1":"12","2":"6","3":"11","4":"<data.frame [280 Ã 6]>","5":"STAND_TO_LIE","6":"254"},{"1":"13","2":"7","3":"11","4":"<data.frame [206 Ã 6]>","5":"STAND_TO_LIE","6":"255"},{"1":"14","2":"7","3":"11","4":"<data.frame [200 Ã 6]>","5":"STAND_TO_LIE","6":"256"},{"1":"15","2":"8","3":"11","4":"<data.frame [211 Ã 6]>","5":"STAND_TO_LIE","6":"257"},{"1":"16","2":"8","3":"11","4":"<data.frame [196 Ã 6]>","5":"STAND_TO_LIE","6":"258"},{"1":"17","2":"9","3":"11","4":"<data.frame [188 Ã 6]>","5":"STAND_TO_LIE","6":"259"},{"1":"18","2":"9","3":"11","4":"<data.frame [259 Ã 6]>","5":"STAND_TO_LIE","6":"260"},{"1":"19","2":"10","3":"11","4":"<data.frame [229 Ã 6]>","5":"STAND_TO_LIE","6":"261"},{"1":"20","2":"10","3":"11","4":"<data.frame [153 Ã 6]>","5":"STAND_TO_LIE","6":"262"},{"1":"22","2":"11","3":"11","4":"<data.frame [193 Ã 6]>","5":"STAND_TO_LIE","6":"263"},{"1":"23","2":"11","3":"11","4":"<data.frame [187 Ã 6]>","5":"STAND_TO_LIE","6":"264"},{"1":"24","2":"12","3":"11","4":"<data.frame [205 Ã 6]>","5":"STAND_TO_LIE","6":"265"},{"1":"25","2":"12","3":"11","4":"<data.frame [167 Ã 6]>","5":"STAND_TO_LIE","6":"266"},{"1":"26","2":"13","3":"11","4":"<data.frame [195 Ã 6]>","5":"STAND_TO_LIE","6":"267"},{"1":"27","2":"13","3":"11","4":"<data.frame [191 Ã 6]>","5":"STAND_TO_LIE","6":"268"},{"1":"28","2":"14","3":"11","4":"<data.frame [342 Ã 6]>","5":"STAND_TO_LIE","6":"269"},{"1":"29","2":"14","3":"11","4":"<data.frame [264 Ã 6]>","5":"STAND_TO_LIE","6":"270"},{"1":"30","2":"15","3":"11","4":"<data.frame [194 Ã 6]>","5":"STAND_TO_LIE","6":"271"},{"1":"31","2":"15","3":"11","4":"<data.frame [263 Ã 6]>","5":"STAND_TO_LIE","6":"272"},{"1":"32","2":"16","3":"11","4":"<data.frame [235 Ã 6]>","5":"STAND_TO_LIE","6":"273"},{"1":"33","2":"16","3":"11","4":"<data.frame [192 Ã 6]>","5":"STAND_TO_LIE","6":"274"},{"1":"34","2":"17","3":"11","4":"<data.frame [238 Ã 6]>","5":"STAND_TO_LIE","6":"275"},{"1":"35","2":"17","3":"11","4":"<data.frame [336 Ã 6]>","5":"STAND_TO_LIE","6":"276"},{"1":"36","2":"18","3":"11","4":"<data.frame [297 Ã 6]>","5":"STAND_TO_LIE","6":"277"},{"1":"37","2":"18","3":"11","4":"<data.frame [244 Ã 6]>","5":"STAND_TO_LIE","6":"278"},{"1":"38","2":"19","3":"11","4":"<data.frame [256 Ã 6]>","5":"STAND_TO_LIE","6":"279"},{"1":"39","2":"19","3":"11","4":"<data.frame [320 Ã 6]>","5":"STAND_TO_LIE","6":"280"},{"1":"40","2":"20","3":"11","4":"<data.frame [425 Ã 6]>","5":"STAND_TO_LIE","6":"281"},{"1":"41","2":"20","3":"11","4":"<data.frame [365 Ã 6]>","5":"STAND_TO_LIE","6":"282"},{"1":"42","2":"21","3":"11","4":"<data.frame [313 Ã 6]>","5":"STAND_TO_LIE","6":"283"},{"1":"43","2":"21","3":"11","4":"<data.frame [274 Ã 6]>","5":"STAND_TO_LIE","6":"284"},{"1":"44","2":"22","3":"11","4":"<data.frame [173 Ã 6]>","5":"STAND_TO_LIE","6":"285"},{"1":"45","2":"22","3":"11","4":"<data.frame [139 Ã 6]>","5":"STAND_TO_LIE","6":"286"},{"1":"46","2":"23","3":"11","4":"<data.frame [253 Ã 6]>","5":"STAND_TO_LIE","6":"287"},{"1":"47","2":"23","3":"11","4":"<data.frame [260 Ã 6]>","5":"STAND_TO_LIE","6":"288"},{"1":"48","2":"24","3":"11","4":"<data.frame [494 Ã 6]>","5":"STAND_TO_LIE","6":"289"},{"1":"49","2":"24","3":"11","4":"<data.frame [248 Ã 6]>","5":"STAND_TO_LIE","6":"290"},{"1":"50","2":"25","3":"11","4":"<data.frame [185 Ã 6]>","5":"STAND_TO_LIE","6":"291"},{"1":"51","2":"25","3":"11","4":"<data.frame [241 Ã 6]>","5":"STAND_TO_LIE","6":"292"},{"1":"52","2":"26","3":"11","4":"<data.frame [178 Ã 6]>","5":"STAND_TO_LIE","6":"293"},{"1":"53","2":"26","3":"11","4":"<data.frame [167 Ã 6]>","5":"STAND_TO_LIE","6":"294"},{"1":"54","2":"27","3":"11","4":"<data.frame [216 Ã 6]>","5":"STAND_TO_LIE","6":"295"},{"1":"55","2":"27","3":"11","4":"<data.frame [165 Ã 6]>","5":"STAND_TO_LIE","6":"296"},{"1":"58","2":"29","3":"11","4":"<data.frame [234 Ã 6]>","5":"STAND_TO_LIE","6":"297"},{"1":"59","2":"29","3":"11","4":"<data.frame [187 Ã 6]>","5":"STAND_TO_LIE","6":"298"},{"1":"60","2":"30","3":"11","4":"<data.frame [156 Ã 6]>","5":"STAND_TO_LIE","6":"299"},{"1":"61","2":"30","3":"11","4":"<data.frame [249 Ã 6]>","5":"STAND_TO_LIE","6":"300"},{"1":"1","2":"1","3":"12","4":"<data.frame [191 Ã 6]>","5":"LIE_TO_STAND","6":"301"},{"1":"2","2":"1","3":"12","4":"<data.frame [242 Ã 6]>","5":"LIE_TO_STAND","6":"302"},{"1":"3","2":"2","3":"12","4":"<data.frame [181 Ã 6]>","5":"LIE_TO_STAND","6":"303"},{"1":"4","2":"2","3":"12","4":"<data.frame [181 Ã 6]>","5":"LIE_TO_STAND","6":"304"},{"1":"5","2":"3","3":"12","4":"<data.frame [184 Ã 6]>","5":"LIE_TO_STAND","6":"305"},{"1":"6","2":"3","3":"12","4":"<data.frame [167 Ã 6]>","5":"LIE_TO_STAND","6":"306"},{"1":"7","2":"4","3":"12","4":"<data.frame [166 Ã 6]>","5":"LIE_TO_STAND","6":"307"},{"1":"8","2":"4","3":"12","4":"<data.frame [171 Ã 6]>","5":"LIE_TO_STAND","6":"308"},{"1":"9","2":"5","3":"12","4":"<data.frame [173 Ã 6]>","5":"LIE_TO_STAND","6":"309"},{"1":"10","2":"5","3":"12","4":"<data.frame [142 Ã 6]>","5":"LIE_TO_STAND","6":"310"},{"1":"11","2":"6","3":"12","4":"<data.frame [186 Ã 6]>","5":"LIE_TO_STAND","6":"311"},{"1":"12","2":"6","3":"12","4":"<data.frame [254 Ã 6]>","5":"LIE_TO_STAND","6":"312"},{"1":"13","2":"7","3":"12","4":"<data.frame [206 Ã 6]>","5":"LIE_TO_STAND","6":"313"},{"1":"14","2":"7","3":"12","4":"<data.frame [170 Ã 6]>","5":"LIE_TO_STAND","6":"314"},{"1":"15","2":"8","3":"12","4":"<data.frame [173 Ã 6]>","5":"LIE_TO_STAND","6":"315"},{"1":"17","2":"9","3":"12","4":"<data.frame [168 Ã 6]>","5":"LIE_TO_STAND","6":"316"},{"1":"18","2":"9","3":"12","4":"<data.frame [149 Ã 6]>","5":"LIE_TO_STAND","6":"317"},{"1":"19","2":"10","3":"12","4":"<data.frame [118 Ã 6]>","5":"LIE_TO_STAND","6":"318"},{"1":"20","2":"10","3":"12","4":"<data.frame [137 Ã 6]>","5":"LIE_TO_STAND","6":"319"},{"1":"22","2":"11","3":"12","4":"<data.frame [139 Ã 6]>","5":"LIE_TO_STAND","6":"320"},{"1":"23","2":"11","3":"12","4":"<data.frame [196 Ã 6]>","5":"LIE_TO_STAND","6":"321"},{"1":"24","2":"12","3":"12","4":"<data.frame [207 Ã 6]>","5":"LIE_TO_STAND","6":"322"},{"1":"25","2":"12","3":"12","4":"<data.frame [188 Ã 6]>","5":"LIE_TO_STAND","6":"323"},{"1":"26","2":"13","3":"12","4":"<data.frame [259 Ã 6]>","5":"LIE_TO_STAND","6":"324"},{"1":"27","2":"13","3":"12","4":"<data.frame [197 Ã 6]>","5":"LIE_TO_STAND","6":"325"},{"1":"28","2":"14","3":"12","4":"<data.frame [289 Ã 6]>","5":"LIE_TO_STAND","6":"326"},{"1":"29","2":"14","3":"12","4":"<data.frame [197 Ã 6]>","5":"LIE_TO_STAND","6":"327"},{"1":"30","2":"15","3":"12","4":"<data.frame [201 Ã 6]>","5":"LIE_TO_STAND","6":"328"},{"1":"31","2":"15","3":"12","4":"<data.frame [159 Ã 6]>","5":"LIE_TO_STAND","6":"329"},{"1":"32","2":"16","3":"12","4":"<data.frame [146 Ã 6]>","5":"LIE_TO_STAND","6":"330"},{"1":"33","2":"16","3":"12","4":"<data.frame [156 Ã 6]>","5":"LIE_TO_STAND","6":"331"},{"1":"34","2":"17","3":"12","4":"<data.frame [200 Ã 6]>","5":"LIE_TO_STAND","6":"332"},{"1":"35","2":"17","3":"12","4":"<data.frame [238 Ã 6]>","5":"LIE_TO_STAND","6":"333"},{"1":"36","2":"18","3":"12","4":"<data.frame [206 Ã 6]>","5":"LIE_TO_STAND","6":"334"},{"1":"37","2":"18","3":"12","4":"<data.frame [192 Ã 6]>","5":"LIE_TO_STAND","6":"335"},{"1":"38","2":"19","3":"12","4":"<data.frame [161 Ã 6]>","5":"LIE_TO_STAND","6":"336"},{"1":"39","2":"19","3":"12","4":"<data.frame [140 Ã 6]>","5":"LIE_TO_STAND","6":"337"},{"1":"40","2":"20","3":"12","4":"<data.frame [172 Ã 6]>","5":"LIE_TO_STAND","6":"338"},{"1":"41","2":"20","3":"12","4":"<data.frame [158 Ã 6]>","5":"LIE_TO_STAND","6":"339"},{"1":"42","2":"21","3":"12","4":"<data.frame [206 Ã 6]>","5":"LIE_TO_STAND","6":"340"},{"1":"43","2":"21","3":"12","4":"<data.frame [196 Ã 6]>","5":"LIE_TO_STAND","6":"341"},{"1":"44","2":"22","3":"12","4":"<data.frame [257 Ã 6]>","5":"LIE_TO_STAND","6":"342"},{"1":"46","2":"23","3":"12","4":"<data.frame [176 Ã 6]>","5":"LIE_TO_STAND","6":"343"},{"1":"47","2":"23","3":"12","4":"<data.frame [161 Ã 6]>","5":"LIE_TO_STAND","6":"344"},{"1":"48","2":"24","3":"12","4":"<data.frame [322 Ã 6]>","5":"LIE_TO_STAND","6":"345"},{"1":"49","2":"24","3":"12","4":"<data.frame [196 Ã 6]>","5":"LIE_TO_STAND","6":"346"},{"1":"50","2":"25","3":"12","4":"<data.frame [323 Ã 6]>","5":"LIE_TO_STAND","6":"347"},{"1":"51","2":"25","3":"12","4":"<data.frame [187 Ã 6]>","5":"LIE_TO_STAND","6":"348"},{"1":"52","2":"26","3":"12","4":"<data.frame [244 Ã 6]>","5":"LIE_TO_STAND","6":"349"},{"1":"53","2":"26","3":"12","4":"<data.frame [183 Ã 6]>","5":"LIE_TO_STAND","6":"350"},{"1":"54","2":"27","3":"12","4":"<data.frame [125 Ã 6]>","5":"LIE_TO_STAND","6":"351"},{"1":"55","2":"27","3":"12","4":"<data.frame [153 Ã 6]>","5":"LIE_TO_STAND","6":"352"},{"1":"56","2":"28","3":"12","4":"<data.frame [181 Ã 6]>","5":"LIE_TO_STAND","6":"353"},{"1":"57","2":"28","3":"12","4":"<data.frame [167 Ã 6]>","5":"LIE_TO_STAND","6":"354"},{"1":"58","2":"29","3":"12","4":"<data.frame [179 Ã 6]>","5":"LIE_TO_STAND","6":"355"},{"1":"59","2":"29","3":"12","4":"<data.frame [145 Ã 6]>","5":"LIE_TO_STAND","6":"356"},{"1":"60","2":"30","3":"12","4":"<data.frame [159 Ã 6]>","5":"LIE_TO_STAND","6":"357"},{"1":"61","2":"30","3":"12","4":"<data.frame [147 Ã 6]>","5":"LIE_TO_STAND","6":"358"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<p>So after our aggressive pruning of the data we will have a respectable amount of data left upon which our model can learn.</p>
<h3 id="trainingtesting-split">Training/testing split</h3>
<p>Before we go any further into exploring the data for our model, in an attempt to be as fair as possible with our performance measures, we need to split the data into a train and test set. Since each user performed all activities just once (with the exception of one who only did 10 of the 12 activities) by splitting on <code>userId</code> we will ensure that our model sees new people exclusively when we test it.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# get all users
userIds &lt;- allObservations$userId %&gt;% unique()

# randomly choose 24 (80% of 30 individuals) for training
set.seed(42) # seed for reproducibility
trainIds &lt;- sample(userIds, size = 24)

# set the rest of the users to the testing set
testIds &lt;- setdiff(userIds,trainIds)

# filter data. 
trainData &lt;- filteredObservations %&gt;% 
  filter(userId %in% trainIds)

testData &lt;- filteredObservations %&gt;% 
  filter(userId %in% testIds)</code></pre>
</div>
<h3 id="visualizing-activities">Visualizing activities</h3>
<p>Now that we have trimmed our data by removing activities and splitting off a test set, we can actually visualize the data for each class to see if thereâs any immediately discernible shape that our model may be able to pick up on.</p>
<p>First letâs unpack our data from its dataframe of one-row-per-observation to a tidy version of all the observations.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
unpackedObs &lt;- 1:nrow(trainData) %&gt;% 
  map_df(function(rowNum){
    dataRow &lt;- trainData[rowNum, ]
    dataRow$data[[1]] %&gt;% 
      mutate(
        activityName = dataRow$activityName, 
        observationId = dataRow$observationId,
        time = 1:n() )
  }) %&gt;% 
  gather(reading, value, -time, -activityName, -observationId) %&gt;% 
  separate(reading, into = c(&quot;type&quot;, &quot;direction&quot;), sep = &quot;_&quot;) %&gt;% 
  mutate(type = ifelse(type == &quot;a&quot;, &quot;acceleration&quot;, &quot;gyro&quot;))</code></pre>
</div>
<p>Now we have an unpacked set of our observations, letâs visualize them!</p>
<div class="layout-chunk" data-layout="l-screen-inset">
<pre class="r"><code>
unpackedObs %&gt;% 
  ggplot(aes(x = time, y = value, color = direction)) +
  geom_line(alpha = 0.2) +
  geom_smooth(se = FALSE, alpha = 0.7, size = 0.5) +
  facet_grid(type ~ activityName, scales = &quot;free_y&quot;) +
  theme_minimal() +
  theme( axis.text.x = element_blank() )</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-12-1.png" width="1152" /></p>
</div>
<p>So at least in the accelerometer data patterns definitely emerge. One would imagine that the model may have trouble with the differences between <code>LIE_TO_SIT</code> and <code>LIE_TO_STAND</code> as they have a similar profile on average. The same goes for <code>SIT_TO_STAND</code> and <code>STAND_TO_SIT</code>.</p>
<h2 id="preprocessing">Preprocessing</h2>
<p>Before we can train the neural network, we need to take a couple of steps to preprocess the data.</p>
<h3 id="padding-observations">Padding observations</h3>
<p>First we will decide what length to pad (and truncate) our sequences to by finding what the 98th percentile length is. By not using the very longest observation length this will help us avoid extra-long outlier recordings messing up the padding.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
padSize &lt;- trainData$data %&gt;% 
  map_int(nrow) %&gt;% 
  quantile(p = 0.98) %&gt;% 
  ceiling()
padSize</code></pre>
<pre><code>
98% 
334 </code></pre>
</div>
<p>Now we simply need to convert our list of observations to matrices, then use the super handy <a href="https://keras.rstudio.com/reference/pad_sequences.html"><code>pad_sequences()</code></a> function in Keras to pad all observations and turn them into a 3D tensor for us.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
convertToTensor &lt;- . %&gt;% 
  map(as.matrix) %&gt;% 
  pad_sequences(maxlen = padSize)

trainObs &lt;- trainData$data %&gt;% convertToTensor()
testObs &lt;- testData$data %&gt;% convertToTensor()
  
dim(trainObs)</code></pre>
<pre><code>
[1] 286 334   6</code></pre>
</div>
<p>Wonderful, we now have our data in a nice neural-network-friendly format of a 3D tensor with dimensions <code>(&lt;num obs&gt;, &lt;sequence length&gt;, &lt;channels&gt;)</code>.</p>
<aside>
If we were working with a video instead of sensor data, this would be a 4D Tensor. If we were using FMRI data, this could be a 5D tensor!
</aside>
<h3 id="one-hot-encoding">One-hot encoding</h3>
<p>Thereâs one last thing we need to do before we can train our model, and that is turn our observation classes from integers into one-hot, or dummy encoded, vectors. Luckily, again Keras has supplied us with a very helpful function to do just this.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
oneHotClasses &lt;- . %&gt;% 
  {. - 7} %&gt;%        # bring integers down to 0-6 from 7-12
  to_categorical() # One-hot encode

trainY &lt;- trainData$activity %&gt;% oneHotClasses()
testY &lt;- testData$activity %&gt;% oneHotClasses()</code></pre>
</div>
<h2 id="modeling">Modeling</h2>
<h3 id="architecture">Architecture</h3>
<p>Since we have temporally dense time-series data we will make use of 1D convolutional layers. With temporally-dense data, an RNN has to learn very long dependencies in order to pick up on patterns, CNNs can simply stack a few convolutional layers to build pattern representations of substantial length. Since we are also simply looking for a single classification of activity for each observation, we can just use pooling to âsummarizeâ the CNNs view of the data into a dense layer.</p>
<aside>
For more information on the differences between the two architectures for sequence data see <span class="citation" data-cites="gravesRNN">(Graves <a href="#ref-gravesRNN">2012</a>)</span> and <span class="citation" data-cites="deeplearnBook">(LeCun, Bengio, and Hinton <a href="#ref-deeplearnBook">2015</a>)</span>.
</aside>
<p>In addition to stacking two <a href="https://keras.rstudio.com/reference/layer_conv_1d.html"><code>layer_conv_1d()</code></a> layers, we will use batch norm and dropout (<a href="https://keras.rstudio.com/reference/layer_spatial_dropout_1d.html">the spatial variant</a><span class="citation" data-cites="spatialConvolutions">(Tompson et al. <a href="#ref-spatialConvolutions">2014</a>)</span> on the convolutional layers and <a href="https://keras.rstudio.com/reference/layer_dropout.html">standard</a> on the dense) to regularize the network.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<pre class="r"><code>
input_shape &lt;- dim(trainObs)[-1]
num_classes &lt;- dim(trainY)[2]

filters &lt;- 24     # number of convolutional filters to learn
kernel_size &lt;- 8  # how many time-steps each conv layer sees.
dense_size &lt;- 48  # size of our penultimate dense layer. 

# Initialize model
model &lt;- keras_model_sequential()
model %&gt;% 
  layer_conv_1d(
    filters = filters,
    kernel_size = kernel_size, 
    input_shape = input_shape,
    padding = &quot;valid&quot;, 
    activation = &quot;relu&quot;
  ) %&gt;%
  layer_batch_normalization() %&gt;%
  layer_spatial_dropout_1d(0.15) %&gt;% 
  layer_conv_1d(
    filters = filters/2,
    kernel_size = kernel_size,
    activation = &quot;relu&quot;,
  ) %&gt;%
  # Apply average pooling:
  layer_global_average_pooling_1d() %&gt;% 
  layer_batch_normalization() %&gt;%
  layer_dropout(0.2) %&gt;% 
  layer_dense(
    dense_size,
    activation = &quot;relu&quot;
  ) %&gt;% 
  layer_batch_normalization() %&gt;%
  layer_dropout(0.25) %&gt;% 
  layer_dense(
    num_classes, 
    activation = &quot;softmax&quot;,
    name = &quot;dense_output&quot;
  ) 

summary(model)</code></pre>
<pre><code>
______________________________________________________________________
Layer (type)                   Output Shape                Param #    
======================================================================
conv1d_1 (Conv1D)              (None, 327, 24)             1176       
______________________________________________________________________
batch_normalization_1 (BatchNo (None, 327, 24)             96         
______________________________________________________________________
spatial_dropout1d_1 (SpatialDr (None, 327, 24)             0          
______________________________________________________________________
conv1d_2 (Conv1D)              (None, 320, 12)             2316       
______________________________________________________________________
global_average_pooling1d_1 (Gl (None, 12)                  0          
______________________________________________________________________
batch_normalization_2 (BatchNo (None, 12)                  48         
______________________________________________________________________
dropout_1 (Dropout)            (None, 12)                  0          
______________________________________________________________________
dense_1 (Dense)                (None, 48)                  624        
______________________________________________________________________
batch_normalization_3 (BatchNo (None, 48)                  192        
______________________________________________________________________
dropout_2 (Dropout)            (None, 48)                  0          
______________________________________________________________________
dense_output (Dense)           (None, 6)                   294        
======================================================================
Total params: 4,746
Trainable params: 4,578
Non-trainable params: 168
______________________________________________________________________</code></pre>
</div>
<h3 id="training">Training</h3>
<p>Now we can train the model using our test and training data. Note that we use <code>callback_model_checkpoint()</code> to ensure that we save only the best variation of the model (desirable since at some point in training the model may begin to overfit or otherwise stop improving).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Compile model
model %&gt;% compile(
  loss = &quot;categorical_crossentropy&quot;,
  optimizer = &quot;rmsprop&quot;,
  metrics = &quot;accuracy&quot;
)

trainHistory &lt;- model %&gt;%
  fit(
    x = trainObs, y = trainY,
    epochs = 350,
    validation_data = list(testObs, testY),
    callbacks = list(
      callback_model_checkpoint(&quot;best_model.h5&quot;, 
                                save_best_only = TRUE)
    )
  )</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-page">
<p><img src="index_files/figure-html5/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<p>The model is learning something! We get a respectable 94.4% accuracy on the validation data, not bad with six possible classes to choose from. Letâs look into the validation performance a little deeper to see where the model is messing up.</p>
<h3 id="evaluation">Evaluation</h3>
<p>Now that we have a trained model letâs investigate the errors that it made on our testing data. We can load the best model from training based upon validation accuracy and then look at each observation, what the model predicted, how high a probability it assigned, and the true activity label.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<pre class="r"><code>
# dataframe to get labels onto one-hot encoded prediction columns
oneHotToLabel &lt;- activityLabels %&gt;% 
  mutate(number = number - 7) %&gt;% 
  filter(number &gt;= 0) %&gt;% 
  mutate(class = paste0(&quot;V&quot;,number + 1)) %&gt;% 
  select(-number)

# Load our best model checkpoint
bestModel &lt;- load_model_hdf5(&quot;best_model.h5&quot;)

tidyPredictionProbs &lt;- bestModel %&gt;% 
  predict(testObs) %&gt;% 
  as_data_frame() %&gt;% 
  mutate(obs = 1:n()) %&gt;% 
  gather(class, prob, -obs) %&gt;% 
  right_join(oneHotToLabel, by = &quot;class&quot;)

predictionPerformance &lt;- tidyPredictionProbs %&gt;% 
  group_by(obs) %&gt;% 
  summarise(
    highestProb = max(prob),
    predicted = label[prob == highestProb]
  ) %&gt;% 
  mutate(
    truth = testData$activityName,
    correct = truth == predicted
  ) 

predictionPerformance %&gt;% paged_table()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["obs"],"name":[1],"type":["int"],"align":["right"]},{"label":["highestProb"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["predicted"],"name":[3],"type":["fctr"],"align":["left"]},{"label":["truth"],"name":[4],"type":["fctr"],"align":["left"]},{"label":["correct"],"name":[5],"type":["lgl"],"align":["right"]}],"data":[{"1":"1","2":"0.8970604","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"2","2":"0.8936158","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"3","2":"0.9341052","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"4","2":"0.8462924","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"5","2":"0.9840696","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"6","2":"0.9990620","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"7","2":"0.9979126","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"8","2":"0.9985707","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"9","2":"0.9938900","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"10","2":"0.9877772","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"11","2":"0.8682424","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"12","2":"0.9810832","3":"STAND_TO_SIT","4":"STAND_TO_SIT","5":"TRUE"},{"1":"13","2":"0.9777718","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"14","2":"0.9474822","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"15","2":"0.6397119","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"16","2":"0.8954912","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"17","2":"0.8543505","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"18","2":"0.9409921","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"19","2":"0.9647168","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"20","2":"0.9418934","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"21","2":"0.8991503","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"22","2":"0.8605189","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"23","2":"0.9710508","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"24","2":"0.9450229","3":"SIT_TO_STAND","4":"SIT_TO_STAND","5":"TRUE"},{"1":"25","2":"0.9901183","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"26","2":"0.8780518","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"27","2":"0.8383064","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"28","2":"0.9977659","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"29","2":"0.9974304","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"30","2":"0.9984117","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"31","2":"0.7808345","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"32","2":"0.9924496","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"33","2":"0.9964616","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"34","2":"0.9928626","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"35","2":"0.8810695","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"36","2":"0.9983010","3":"SIT_TO_LIE","4":"SIT_TO_LIE","5":"TRUE"},{"1":"37","2":"0.7238058","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"38","2":"0.8970255","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"39","2":"0.5241567","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"40","2":"0.9724941","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"41","2":"0.9658489","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"42","2":"0.8779612","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"43","2":"0.6016794","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"44","2":"0.9966748","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"45","2":"0.9988185","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"46","2":"0.9109790","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"47","2":"0.9904966","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"48","2":"0.9998224","3":"LIE_TO_SIT","4":"LIE_TO_SIT","5":"TRUE"},{"1":"49","2":"0.9429878","3":"STAND_TO_LIE","4":"STAND_TO_LIE","5":"TRUE"},{"1":"50","2":"0.8499932","3":"STAND_TO_LIE","4":"STAND_TO_LIE","5":"TRUE"},{"1":"51","2":"0.6778994","3":"SIT_TO_LIE","4":"STAND_TO_LIE","5":"FALSE"},{"1":"52","2":"0.9997874","3":"STAND_TO_LIE","4":"STAND_TO_LIE","5":"TRUE"},{"1":"53","2":"0.7534851","3":"STAND_TO_LIE","4":"STAND_TO_LIE","5":"TRUE"},{"1":"54","2":"0.9621393","3":"STAND_TO_LIE","4":"STAND_TO_LIE","5":"TRUE"},{"1":"55","2":"0.9653141","3":"SIT_TO_LIE","4":"STAND_TO_LIE","5":"FALSE"},{"1":"56","2":"0.8495207","3":"STAND_TO_LIE","4":"STAND_TO_LIE","5":"TRUE"},{"1":"57","2":"0.9999526","3":"STAND_TO_LIE","4":"STAND_TO_LIE","5":"TRUE"},{"1":"58","2":"0.9915054","3":"STAND_TO_LIE","4":"STAND_TO_LIE","5":"TRUE"},{"1":"59","2":"0.8550630","3":"STAND_TO_LIE","4":"STAND_TO_LIE","5":"TRUE"},{"1":"60","2":"0.9982007","3":"STAND_TO_LIE","4":"STAND_TO_LIE","5":"TRUE"},{"1":"61","2":"0.8607119","3":"LIE_TO_STAND","4":"LIE_TO_STAND","5":"TRUE"},{"1":"62","2":"0.7846971","3":"LIE_TO_STAND","4":"LIE_TO_STAND","5":"TRUE"},{"1":"63","2":"0.8420011","3":"LIE_TO_STAND","4":"LIE_TO_STAND","5":"TRUE"},{"1":"64","2":"0.8904631","3":"LIE_TO_STAND","4":"LIE_TO_STAND","5":"TRUE"},{"1":"65","2":"0.9472615","3":"LIE_TO_STAND","4":"LIE_TO_STAND","5":"TRUE"},{"1":"66","2":"0.8901521","3":"LIE_TO_STAND","4":"LIE_TO_STAND","5":"TRUE"},{"1":"67","2":"0.9170208","3":"LIE_TO_STAND","4":"LIE_TO_STAND","5":"TRUE"},{"1":"68","2":"0.8959852","3":"LIE_TO_STAND","4":"LIE_TO_STAND","5":"TRUE"},{"1":"69","2":"0.7956741","3":"LIE_TO_SIT","4":"LIE_TO_STAND","5":"FALSE"},{"1":"70","2":"0.7266123","3":"LIE_TO_STAND","4":"LIE_TO_STAND","5":"TRUE"},{"1":"71","2":"0.9663992","3":"LIE_TO_SIT","4":"LIE_TO_STAND","5":"FALSE"},{"1":"72","2":"0.8346738","3":"LIE_TO_STAND","4":"LIE_TO_STAND","5":"TRUE"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<p>First, letâs look at how âconfidentâ the model was by if the prediction was correct or not.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<pre class="r"><code>
predictionPerformance %&gt;% 
  mutate(result = ifelse(correct, &#39;Correct&#39;, &#39;Incorrect&#39;)) %&gt;% 
  ggplot(aes(highestProb)) +
  geom_histogram(binwidth = 0.01) +
  geom_rug(alpha = 0.5) +
  facet_grid(result~.) +
  ggtitle(&quot;Probabilities associated with prediction by correctness&quot;)</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-22-1.png" width="576" /></p>
</div>
<p>Reassuringly it seems the model was, on average, less confident about its classifications for the incorrect results than the correct ones. (Although, the sample size is too small to say anything definitively.)</p>
<aside>
If you desire a model that can truly tell you how âconfidentâ it is in a prediction (rather than just a probability), look into bayesian neural networks<span class="citation" data-cites="bayesianNetworks">(Kononenko <a href="#ref-bayesianNetworks">1989</a>)</span> and the more recent use of dropout-as-bayes<span class="citation" data-cites="dropoutAsBayes">(Gal and Ghahramani <a href="#ref-dropoutAsBayes">2016</a>)</span>.
</aside>
<p>Letâs see what activities the model had the hardest time with using a confusion matrix.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
predictionPerformance %&gt;% 
  group_by(truth, predicted) %&gt;% 
  summarise(count = n()) %&gt;% 
  mutate(good = truth == predicted) %&gt;% 
  ggplot(aes(x = truth,  y = predicted)) +
  geom_point(aes(size = count, color = good)) +
  geom_text(aes(label = count), 
            hjust = 0, vjust = 0, 
            nudge_x = 0.1, nudge_y = 0.1) + 
  guides(color = FALSE, size = FALSE) +
  theme_minimal()</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-23-1.png" width="768" /></p>
</div>
<p>We see that, as the preliminary visualization suggested, the model had a bit of trouble with distinguishing between <code>LIE_TO_SIT</code> and <code>LIE_TO_STAND</code> classes, along with the <code>SIT_TO_LIE</code> and <code>STAND_TO_LIE</code>, which also have similar visual profiles.</p>
<h2 id="future-directions">Future directions</h2>
<p>The most obvious future direction to take this analysis would be to attempt to make the model more general by working with more of the supplied activity types. Another interesting direction would be to not separate the recordings into distinct âobservationsâ but instead keep them as one streaming set of data, much like a real world deployment of a model would work, and see how well a model could classify streaming data and detect changes in activity.</p>
<div id="refs" class="references">
<div id="ref-dropoutAsBayes">
<p>Gal, Yarin, and Zoubin Ghahramani. 2016. âDropout as a Bayesian Approximation: Representing Model Uncertainty in Deep Learning.â In <em>International Conference on Machine Learning</em>, 1050â9.</p>
</div>
<div id="ref-gravesRNN">
<p>Graves, Alex. 2012. âSupervised Sequence Labelling.â In <em>Supervised Sequence Labelling with Recurrent Neural Networks</em>, 5â13. Springer.</p>
</div>
<div id="ref-bayesianNetworks">
<p>Kononenko, Igor. 1989. âBayesian Neural Networks.â <em>Biological Cybernetics</em> 61 (5). Springer: 361â70.</p>
</div>
<div id="ref-deeplearnBook">
<p>LeCun, Yann, Yoshua Bengio, and Geoffrey Hinton. 2015. âDeep Learning.â <em>Nature</em> 521 (7553). Nature Publishing Group: 436.</p>
</div>
<div id="ref-dataSource">
<p>Reyes-Ortiz, Jorge-L, Luca Oneto, Albert SamÃ , Xavier Parra, and Davide Anguita. 2016. âTransition-Aware Human Activity Recognition Using Smartphones.â <em>Neurocomputing</em> 171. Elsevier: 754â67.</p>
</div>
<div id="ref-spatialConvolutions">
<p>Tompson, Jonathan, Ross Goroshin, Arjun Jain, Yann LeCun, and Christoph Bregler. 2014. âEfficient Object Localization Using Convolutional Networks.â <em>CoRR</em> abs/1411.4280. <a href="http://arxiv.org/abs/1411.4280" class="uri">http://arxiv.org/abs/1411.4280</a>.</p>
</div>
</div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/2018-07-17-activity-detection/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=Classifying%20physical%20activity%20from%20smartphone%20data&amp;url=https%3A%2F%2Fblogs.rstudio.com%2Ftensorflow%2Fposts%2F2018-07-17-activity-detection%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fblogs.rstudio.com%2Ftensorflow%2Fposts%2F2018-07-17-activity-detection%2F&amp;title=Classifying%20physical%20activity%20from%20smartphone%20data">
        <i class="fab fa-linkedin"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://tensorflow-for-r-blog.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script>
var disqus_config = function () {
  this.page.url = 'https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/';
  this.page.identifier = 'posts/2018-07-17-activity-detection/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://tensorflow-for-r-blog.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
  <p>
    <div class="subscribe">
<div id="subscribe-caption" style="line-height: 1.2; margin-bottom: 2px;">Enjoy this blog? Get notified of new posts by email:</div>

<script src="https://app-ab02.marketo.com/js/forms2/js/forms2.min.js"></script>
<form class="mtktoBlogEmailForm" id="mktoForm_2224"></form>
<script>

// establish metrics based on where the form is located
var in_sidebar = $('#subscribe-caption').parents('.sidebar-section').length;
if (in_sidebar) {
  var form_width = 190;
  var base_width = form_width - 23;
  var email_width = base_width + 'px';
  var label_width = (base_width - 20) + 'px';
  var button_width = email_width;
  var button_padding = '30px';
  var button_margin = '';
  var font_size = '12px';
} else {
  var form_width = 400;
  var base_width = form_width - 23;
  var email_width = base_width + 'px';
  var label_width = (base_width - 20) + 'px';
  var button_width = email_width;
  var button_padding = '30px';
  var button_margin = '12px';
  var font_size = '15px';
}

$('#subscribe-caption')
  .css('width', base_width)
  .css('font-size', font_size);


MktoForms2.loadForm("https://app-ab02.marketo.com", "709-NXN-706", 2224, function(form) {

  // get jquery reference to form
  form = $(form.getFormElem().get(0));

  $(form).css('width', form_width + 'px');
  $(form).find('.mktoOffset').remove();
  $(form).find('.mktoGutter').remove();
  $(form).find('.mktoEmailField').css('width', email_width);
  $(form).find('.mktoLabel').children().attr('style', 'font-weight: 400');
  $(form).find('.mktoLabel')
      .css('width', label_width)
      .css('font-size', font_size);
  $(form).find('.mktoButtonRow')
      .css('width', button_width)
      .css('text-align', 'center');
  $(form).find('.mktoButtonWrap').attr('style', '');
  $(form).find('.mktoButton')
      .css('margin-top', '10px')
      .css('padding-left', button_padding)
      .css('padding-right', button_padding)
      .css('font-size', font_size)
      .css('margin-top', button_margin);
});
</script>
Posts also available at <a href="https://www.r-bloggers.com">r-bloggers</a>

<script>
  document.addEventListener("DOMContentLoaded", function(){
    var menulink = document.querySelector("a[href='#category:R']");
    if (menulink) menulink.parentNode.style.display = "None";
    
    for (var e of document.querySelectorAll(".dt-tag")) {
      if (e.innerHTML == 'R') e.style.display = "None";
    }
  });
</script>
</div>
  </p>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="updates-and-corrections">Corrections</h3>
  <p>If you see mistakes or want to suggest changes, please <a href="https://github.com/nstrayer/activity_detection_post/issues/new">create an issue</a> on the source repository.</p>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Source code is available at <a href="https://github.com/nstrayer/activity_detection_post">https://github.com/nstrayer/activity_detection_post</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Strayer (2018, July 17). RStudio AI Blog: Classifying physical activity from smartphone data. Retrieved from https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{strayer2018classifying,
  author = {Strayer, Nick},
  title = {RStudio AI Blog: Classifying physical activity from smartphone data},
  url = {https://blogs.rstudio.com/tensorflow/posts/2018-07-17-activity-detection/},
  year = {2018}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>

